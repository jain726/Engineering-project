function [initial_speed, final_speed] = M3_sub4_222_21_jain726(Test_data)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ENGR 132 
% Program Description 
% Sub function to find the initial and final velocity from the velocity
% data using change in slope.
%
% Function Call
% [initial_speed, final_speed] = M3_sub4_222_21_jain726(Test_data)
%
% Input Arguments
% Test Data
%
% Output Arguments
% 1) Initial Velocity (averaged over every 5 columns)
% 2) Final Velocity (maximum value, averaged over every 5 columns)
%
% Assignment Information
%   Assignment:     M3, sub4
%   Team member:    Max Barish, mbarish@purdue.edu 
%                   Sidh Jain, jain726@purdue.edu 
%                   Spencer Isbel, isbells@purdue.edu 
%                   Saran Fujiwara, sfujiwa@purdue.edu
%   Team ID:        222-21
%   Academic Integrity:
%     [] We worked with one or more peers but our collaboration
%        maintained academic integrity.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% INITIALIZATION
data = readmatrix('Sp25_cruiseAuto_experimental_data');
[numRows, numCols] = size(data);
Initial_Speed_Vector = [];
Final_Speed_Vector = [];
threshold = 0.001; % Small change threshold to detect increase

%% CALCULATIONS
for col = 2:numCols
    columnData = data(:, col);
    dV = diff(columnData);  % Change in velocity

    % Find first index where change exceeds threshold
    startIdx = find(dV > threshold, 1, 'first');
    if ~isempty(startIdx) && startIdx > 1
        Initial_speed = mean(columnData(1:startIdx-1)); % AVERAGE before startIdx
    % else
    %     Initial_speed = NaN;  % If no increase is found or startIdx = 1
    end

    Final_speed = max(columnData);

    Initial_Speed_Vector = [Initial_Speed_Vector, Initial_speed];
    Final_Speed_Vector = [Final_Speed_Vector, Final_speed];
end

%% AVERAGING INTO 9 VALUES
Initial_Speed_Vector = mean(reshape(Initial_Speed_Vector, 5, []));
Final_Speed_Vector = mean(reshape(Final_Speed_Vector, 5, []));

%% OUTPUT
initial_speed = Initial_Speed_Vector;
final_speed = Final_Speed_Vector;

end
